---
title: RDP Bitmap Cache
summary: 'The RDP Bitmap Cache contains partial image captures, in the bitmap format, of the remote host screen from Remote Desktop sessions. This feature is implemented to reduce the amount of data sent by the server.\n\nInformation of interest: small bitmap images, with a width of 64 pixels and a height of up to 64 pixels, that represent pieces of the content displayed in past Remote Desktop sessions of the user.\n\nThousands of tiles may be available for a given user RDP Bitmap Cache folder.'
keywords:
tags:
  - windows_lateral_movement
  - windows_lateral_movement_src
  - windows_remote_desktop
  - windows_remote_desktop_src
  - windows_misc
location: '"bcache*.bmc" and "cache????.bin" files under the "Terminal Server Client\Cache" directory.\n\nWindows XP / Windows Server 2003:\n<SYSTEMDRIVE>:\Documents and Settings\<USERNAME>\Local Settings\Application Data\Microsoft\Terminal Server Client\Cache\*\n\nWindows 7 and later:\n<SYSTEMDRIVE>:\Users\<USERNAME>\AppData\Local\Microsoft\Terminal Server Client\Cache\*'
last_updated: 2024-01-19
sidebar: sidebar
permalink: windows_rdp_bitmap_cache.html
folder: windows
---

### Overview

The `RDP Bitmap Cache` contains partial image captures, in the bitmap format,
of the remote host screen from past Remote Desktop sessions. This feature is
implemented to reduce the amount of data sent by the server to save bandwidth
usage and improve user experience in case of a slow network connection.

Bitmap caching can be deactivated client-side in `mstsc.exe` `Remote Desktop`
client by deactivation the "Persistent bitmap caching" option.

### Information of interest

The `RDP Bitmap Cache` may sometimes be used to retrieve and identify what
was displayed in past Remote Desktop sessions of the user. The image captures
are stored as small bitmap images, with a width of 64 pixels and a height of up
to 64 pixels.

Thousands of tiles may be available for a given user `RDP Bitmap Cache` folder.

### Tool(s)

The [`bmc-tools`](https://github.com/ANSSI-FR/bmc-tools) Python script can be
used to process `bcache*.bmc` and `cache????.bin` files to extract the bitmap
images. A bitmap aggregating all the extracted tiles can be generated by
`bmc-tools`. However, as of 2024-01-19,
[the script loops endlessly if corrupted tiles are found during the aggregation process](https://github.com/ANSSI-FR/bmc-tools/pull/16).

```bash
# -b option: generates a collage bitmap aggregating all the tiles.

bmc-tools.py -s <SOURCE_FOLDER> -d <DESTINATION_FOLDER> -b
```

A compiled version of the `bmc-tools` Python script (compiled with
`PyInstaller`)
[bmc-tools-compiled](https://github.com/Qazeer/bmc-tools-compiled/) may also be
used. The
[`Execute-BmcTools.ps1`](https://gist.github.com/Qazeer/3a6d43a117bbece6d83e7e79687e0870)
PowerShell script (`KAPE` module `PowerShell_Execute-BmcTools`) leverage the
compiled version to recursively process the specified input folder to execute
`bmc-tools.exe` over each `Bitmap Cache` subfolder(s) found.

### References

  - [Hejely Lab - What information can you retrieve from lateral movement performed via RDP?](https://hejelylab.github.io/blog/IRC/RDP-Bitmap-Cache)

  - [ANSSI - BMC-Tools](https://github.com/ANSSI-FR/bmc-tools)
